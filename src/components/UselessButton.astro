---
// src/components/UselessButton.astro
import { useTranslations, defaultLanguage, type LanguageCode } from '@/i18n/ui';
import { Icon } from 'astro-icon/components';

const lang = (Astro.currentLocale as LanguageCode | undefined) ?? defaultLanguage;
const t = useTranslations(lang, 'uselessButton');

const phrases = t('phrases');
const initialTooltip = t('initialTooltip');
---

<div 
  id="useless-button-wrapper" 
  class="hidden relative h-10 w-10 rounded-lg bg-muted/40 p-2 group transition-all duration-300 ease-in-out flex items-center justify-center"
  >
  <button 
    id="useless-button" 
    class="absolute inset-0 z-10 h-full w-full cursor-pointer appearance-none border-none bg-transparent"
    aria-label={initialTooltip}
    title={initialTooltip}
  >
  </button>
  
  <div class="absolute inset-0 flex items-center justify-center">
    <span id="useless-button-icon" class="text-muted-foreground/50 transition-opacity duration-200">
      <Icon name="mdi:circle-outline" class="size-5" />
    </span>
    <span id="useless-button-text" class="absolute text-center text-xs text-muted-foreground opacity-0 transition-opacity duration-200">
      <!-- Texto inyectado por JS -->
    </span>
  </div>
  
  <div class="absolute inset-0 rounded-md border-2 border-dashed border-transparent transition-colors duration-300 group-hover:border-muted-foreground/30"></div>
</div>

<script define:vars={{ phrases }}>
  const wrapper = document.getElementById('useless-button-wrapper');
  const button = document.getElementById('useless-button');
  const iconSpan = document.getElementById('useless-button-icon');
  const textSpan = document.getElementById('useless-button-text');

  const clicksToTrigger = 25;
  const jokeVideos = [
    'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
    'https://youtu.be/UJwA7hu3aug?si=fkZQ8VDxwvQzV1Bl&t=61',
  ];

  let clickCount = 0;
  let timeoutId = null;

  button.addEventListener('click', () => {
    if (clickCount === 0) {
      iconSpan.style.opacity = '0';
      textSpan.style.opacity = '1';
      wrapper.classList.remove('w-10');
      wrapper.classList.add('w-64', 'px-4');
    }

    clickCount++;

    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => {
      clickCount = 0;
      textSpan.style.opacity = '0';
      textSpan.textContent = '';
      iconSpan.style.opacity = '1';
      wrapper.classList.remove('w-64', 'px-4'); 
      wrapper.classList.add('w-10');
    }, 10000);

    if (clickCount >= clicksToTrigger) {
      window.location.href = jokeVideos[Math.floor(Math.random() * jokeVideos.length)];
    } else {
      if (clickCount === 1) {
        textSpan.textContent = phrases[0];
      } else {
        const remainingPhrases = phrases.slice(1);
        textSpan.textContent = remainingPhrases[Math.floor(Math.random() * remainingPhrases.length)];
      }
    }
  });
</script>